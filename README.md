## Учебная виртуальная машина (УВМ)

Проект реализует полный цикл работы с УВМ:

- ассемблер (`cmd/uvm-as`) читает JSON-представление программы и генерирует бинарный файл;
- интерпретатор (`cmd/uvm-run`) исполняет бинарный файл, ведёт объединённую память команд/данных и умеет сохранять дамп памяти в CSV.

### Формат ассемблера (JSON)

Программа — это список инструкций:

```json
{
  "instructions": [
    { "op": "LOAD_CONST", "args": { "value": 703 } },
    { "op": "LOAD_MEM",   "args": {} },
    { "op": "STORE_MEM",  "args": { "addr": 389 } },
    { "op": "NEG",        "args": {} }
  ]
}
```

Поддерживаемые опкоды:

- `LOAD_CONST` — A=5, поле `value` (0–4095) загружается в аккумулятор;
- `LOAD_MEM` — A=15, читает `Mem[ACC]` и возвращает в аккумулятор;
- `STORE_MEM` — A=14, поле `addr` (0–4095), сохраняет ACC в память по адресу;
- `NEG` — A=3, унарный минус над аккумулятором.

### Ассемблирование

```bash
go run ./cmd/uvm-as --src prog.json --out prog.bin        # обычный режим
go run ./cmd/uvm-as --src prog.json --test                # печать IR и байтов
```

В тестовом режиме выводятся поля внутреннего представления и проверочные байтовые пары.

### Интерпретатор и дамп памяти

```bash
go run ./cmd/uvm-run prog.bin dump.csv 0 16
```

Интерпретатор загружает машинный код в память с адреса 0, выполняет программу и сохраняет CSV-дамп указанного диапазона адресов.

### Примеры тестовых программ (этапы 4–5)

#### `prog_neg.json`

Минимальный пример унарного минуса:

1. `LOAD_CONST 21`
2. `NEG`
3. `STORE_MEM addr=128`

```bash
go run ./cmd/uvm-as --src prog_neg.json --out neg.bin
go run ./cmd/uvm-run neg.bin neg.csv 120 135
```

По адресу `128` будет `-21`.

#### `prog_pair_neg.json`

Две независимые операции:

- значения `77` и `512` сохраняются в ячейки `10` и `11`;
- после вычисления унарного минуса результаты попадают в `20` и `21`.

```bash
go run ./cmd/uvm-as --src prog_pair_neg.json --out pair.bin
go run ./cmd/uvm-run pair.bin pair.csv 0 32
```

Ожидаемые значения: `Mem[20] = -77`, `Mem[21] = -512`.

#### `prog_mixed_neg.json`

Комбинированный сценарий:

- сначала формируется число `-888` в ячейке `300`;
- затем число `17` записывается в `301`, считывается через `LOAD_MEM`, инвертируется и кладётся в `302`.

```bash
go run ./cmd/uvm-as --src prog_mixed_neg.json --out mixed.bin
go run ./cmd/uvm-run mixed.bin mixed.csv 296 305
```

В памяти: `Mem[300] = -888`, `Mem[301] = 17`, `Mem[302] = -17`.

#### `prog_vec_neg.json` — тестовая задача этапа 5

Программа заполняет исходный вектор длины 6 (адреса `100–105`), затем поэлементно применяет унарный минус и сохраняет результат в новый диапазон `200–205`.

```bash
go run ./cmd/uvm-as --src prog_vec_neg.json --out vec.bin
go run ./cmd/uvm-run vec.bin vec.csv 96 210
```

После выполнения:

- `Mem[100..105]` содержат исходные данные `[5, 13, 0, 255, 1024, 4095]`;
- `Mem[200..205]` содержат их отрицания `[-5, -13, 0, -255, -1024, -4095]`.

Эти три примера (pair, mixed, vec) демонстрируют вычисления над различными наборами данных и показывают корректный дамп памяти для проверки в отчёте по этапу 5.

